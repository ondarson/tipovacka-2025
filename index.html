<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tipovaƒçka - MS Hokej 2025</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500&family=Open+Sans&display=swap');

    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #0d1117;
      color: #f0f6fc;
      padding: 20px;
      margin: 0;
    }

    h1 {
      font-size: 2.5rem;
      font-family: 'Rajdhani', sans-serif;
      color: #58a6ff;
      margin-bottom: 1rem;
    }

    label {
      margin-bottom: 5px;
    }

    input, select {
      background-color: #161b22;
      color: #f0f6fc;
      border: 1px solid #30363d;
      padding: 8px;
      border-radius: 4px;
      margin-bottom: 15px;
      width: 100%;
      box-sizing: border-box;
    }

    .tip-box {
      background-color: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.4);
    }

    table.tips-table {
      table-layout: fixed;
      border-collapse: collapse;
      width: 100%;
      margin-top: 30px;
      background-color: #161b22;
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      width: 12.5%;
      min-width: 100px;
      font-weight: 600;
      border: 1px solid #30363d;
      padding: 8px;
      text-align: center;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.95rem;
    }

    th {
      font-size: 1.15rem;
      background-color: #21262d;
      color: #58a6ff;
    }

    .match-section {
      margin-bottom: 50px;
    }

    img.flag-icon {
      vertical-align: middle;
      width: 24px;
      height: 18px;
      margin-right: 5px;
    }

    .toggle-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .uniform-scorer {
      width: 100px;
      min-width: 100px;
      max-width: 100px;
    }

    .scorer-cell {
      width: 120px;
      min-width: 120px;
      max-width: 120px;
      height: 48px;
      font-size: 0.95rem;
      border: 1px solid #30363d;
      text-align: center;
      vertical-align: middle;
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      white-space: nowrap;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 1.8rem;
        text-align: center;
      }

      .tip-box {
        padding: 15px;
      }

      table, th, td {
        font-size: 0.75rem;
        padding: 6px;
      }

      .toggle-buttons {
        flex-direction: column;
        align-items: stretch;
      }

      .toggle-buttons button {
        width: 100%;
      }

      .scorer-cell, .uniform-scorer {
        width: auto;
        min-width: unset;
        max-width: unset;
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <h1>Tipovaƒçka - MS v hokeji 2025</h1>
  <div class="tip-box">
    <div style="display: flex; flex-direction: column; gap: 4px;">
      <label for="name">Jm√©no:</label>
      <input type="text" id="name">

      <label for="match">Z√°pas:</label>
      <select id="match"></select>

      <label for="score">Tip na v√Ωsledek (nap≈ô. 3:1):</label>
      <input type="text" id="score" placeholder="nap≈ô. 3:1">
    </div>

    <div style="display: flex; gap: 40px; margin-top: 15px; flex-wrap: wrap;">
      <div style="flex: 1; display: flex; flex-direction: column; gap: 0px; min-width: 200px;">
        <label>St≈ôelci (dom√°c√≠):</label>
        <input type="text" class="scorer home" placeholder="St≈ôelec 1">
        <input type="text" class="scorer home" placeholder="St≈ôelec 2">
        <input type="text" class="scorer home" placeholder="St≈ôelec 3">
      </div>
      <div style="flex: 1; display: flex; flex-direction: column; gap: 0px; min-width: 200px;">
        <label>St≈ôelci (host√©):</label>
        <input type="text" class="scorer away" placeholder="St≈ôelec 1">
        <input type="text" class="scorer away" placeholder="St≈ôelec 2">
        <input type="text" class="scorer away" placeholder="St≈ôelec 3">
      </div>
    </div>

    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button onclick="submitTip()" style="background-color: #2363ff; color: #f0f6fc; border: 1px solid #30363d; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold;">Odeslat tip</button>
    </div>
  </div>

  <div style="display: flex; align-items: center; gap: 20px; margin-top: 20px; margin-bottom: 10px;">
    <h2 style="margin: 0;">Seznam tip≈Ø</h2>
    <div class="toggle-buttons">
      <button onclick="showView('upcoming')" style="background-color: #21262d; color: #f0f6fc; border: 1px solid #30363d; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Nov√© tipy</button>
      <button onclick="showView('past')" style="background-color: #21262d; color: #f0f6fc; border: 1px solid #30363d; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Historie</button>
      <button onclick="showView('points')" style="background-color: #3b82f6; color: #f0f6fc; border: 1px solid #30363d; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold;">Body</button>
      <button onclick="showView('ranking')" style="background-color: #28d97f; color: #f0f6fc; border: 1px solid #30363d; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold;">Po≈ôad√≠</button>
    </div>
    </div>
</div>
<div id="rankingTable" style="display: none; margin-top: 10px; max-width: 400px;">
  <table class="tips-table" style="width: 100%; font-size: 0.9rem;">
    <thead>
      <tr><th>Po≈ôad√≠</th><th>Jm√©no</th></tr>
    </thead>
    <tbody>
      <tr><td style="font-size: 1.1rem;">üèÜ</td><td>Dan</td></tr>
      <tr><td style="font-size: 1.1rem;">ü•à</td><td>Honza</td></tr>
      <tr><td style="font-size: 1.1rem;">ü•â</td><td>Kuba</td></tr>
      <tr><td>4.</td><td>Maris</td></tr>
      <tr><td>5.</td><td>Ondra</td></tr>
      <tr><td>6.</td><td>Patrik</td></tr>
      <tr><td>7.</td><td>Tom</td></tr>
      <tr><td>8.</td><td>V√°≈°a</td></tr>
    </tbody>
  </table>
</div>
<div id="tipsContainer"></div>

  <div id="pointsTable" style="display: none; margin-top: 10px; max-width: 400px;">
    <table class="tips-table" style="width: 100%; font-size: 0.9rem;">
      <thead>
        <tr><th colspan="2">Bodov√°n√≠</th></tr>
      </thead>
      <tbody>
        <tr style="color: #28d97f;"><td>+ 4 body</td><td>P≈ôesn√Ω v√Ωsledek utk√°n√≠</td></tr>
        <tr style="color: #28d97f;"><td>+ 1 bod</td><td>V√≠tƒõz utk√°n√≠</td></tr>
        <tr style="color: #28d97f;"><td>+ 2 body</td><td>G√≥l √∫toƒçn√≠ka</td></tr>
        <tr style="color: #28d97f;"><td>+ 3 body</td><td>G√≥l obr√°nce</td></tr>
        <tr style="color: #ff6c6c;"><td>- 1 bod</td><td>Vylouƒçen√≠ 2 min</td></tr>
        <tr style="color: #ff6c6c;"><td>- 2 body</td><td>Vylouƒçen√≠ 5 min</td></tr>
        <tr style="color: #ff6c6c;"><td>- 3 body</td><td>Vylouƒçen√≠ 10 min</td></tr>
      </tbody>
    </table>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAOq8XW8MFuzPNiTCmyVETBdYwlfu6wqpE",
    authDomain: "tipovacka-2025.firebaseapp.com",
    projectId: "tipovacka-2025",
    storageBucket: "tipovacka-2025.firebasestorage.app",
    messagingSenderId: "500287071213",
    appId: "1:500287071213:web:3c5970d8c6aba92030fde4",
    measurementId: "G-BK4Q2E2K2H"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const countryCodeMap = {
    CZE: "cz", SVK: "sk", FIN: "fi", SWE: "se", CAN: "ca", USA: "us",
    SUI: "ch", GER: "de", DEN: "dk", LAT: "lv", NOR: "no", AUT: "at",
    FRA: "fr", KAZ: "kz", GBR: "gb", SLO: "si"
  };

  const schedule = [
    { date: '2025-05-08', time: '09:30', teams: ['SWE', 'FIN'], datetime: '2025-05-08T09:30:00+02:00' },
    { date: '2025-05-09', time: '16:20', teams: ['AUT', 'FIN'], datetime: '2025-05-09T16:20:00+02:00' },
    { date: '2025-05-09', time: '16:20', teams: ['SUI', 'CZE'], datetime: '2025-05-09T16:20:00+02:00' },
    { date: '2025-05-09', time: '20:20', teams: ['SWE', 'SVK'], datetime: '2025-05-09T20:20:00+02:00' },
    { date: '2025-05-09', time: '20:20', teams: ['DEN', 'USA'], datetime: '2025-05-09T20:20:00+02:00' },
    { date: '2025-05-10', time: '12:20', teams: ['SLO', 'CAN'], datetime: '2025-05-10T12:20:00+02:00' }
  ];

  function getFlagImg(code) {
    const lowerCode = countryCodeMap[code];
    return lowerCode ? `<img class='flag-icon' src='https://flagcdn.com/24x18/${lowerCode}.png' alt='${code}'>` : code;
  }

  function populateMatches() {
    const matchSelect = document.getElementById('match');
    const now = new Date();
    matchSelect.innerHTML = '';
    schedule.forEach((match, i) => {
      const matchTime = new Date(match.datetime);
      if (now < matchTime) {
        const option = document.createElement('option');
        option.value = i;
        option.innerHTML = `${getFlagImg(match.teams[0])} ${match.teams[0]} vs ${getFlagImg(match.teams[1])} ${match.teams[1]} (${match.date} ${match.time})`;
        matchSelect.appendChild(option);
      }
    });
  }

  window.submitTip = async function() {
  const name = document.getElementById('name').value.trim();
  const matchIndex = document.getElementById('match').value;
  const matchId = parseInt(matchIndex);
  const match = schedule[matchId];
  const matchLabel = `${match.teams[0]} vs ${match.teams[1]} (${match.date} ${match.time})`;
  const matchTime = new Date(match.datetime);
  const now = new Date();

  if (now >= matchTime) {
    alert('Tipov√°n√≠ na tento z√°pas ji≈æ nen√≠ mo≈æn√©.');
    return;
  }

  const scoreInput = document.getElementById('score').value.trim();
  const homeScorersInput = Array.from(document.querySelectorAll('.scorer.home')).map(i => i.value.trim()).filter(Boolean);
  const awayScorersInput = Array.from(document.querySelectorAll('.scorer.away')).map(i => i.value.trim()).filter(Boolean);

  if (!name) {
    alert('Pros√≠m vypl≈à jm√©no.');
    return;
  }

  const tipData = {
    name,
    matchId,
    matchLabel,
    datetime: match.datetime,
    score: scoreInput,
    homeScorers: homeScorersInput,
    awayScorers: awayScorersInput
  };

  try {
    await setDoc(doc(db, 'tips', `${name}_${matchId}`), tipData, { merge: true });
    alert('Tip √∫spƒõ≈°nƒõ ulo≈æen!');
    renderTips('upcoming');
  } catch (error) {
    console.error('Chyba p≈ôi ukl√°d√°n√≠ tipu:', error);
    alert('Nastala chyba p≈ôi ukl√°d√°n√≠ tipu.');
  }
};


window.renderTips = async function(mode = 'upcoming') {
  const now = new Date();
  const container = document.getElementById('tipsContainer');
  container.innerHTML = '';

  try {
    const querySnapshot = await getDocs(collection(db, 'tips'));
    const tips = querySnapshot.docs.map(doc => doc.data());

    const tipsByMatchId = {};
    tips.forEach(tip => {
      const matchTime = new Date(tip.datetime);
      const archiveTime = new Date(matchTime.getTime() + 24 * 60 * 60 * 1000);
      const isPast = now >= archiveTime;

      if ((mode === 'upcoming' && !isPast) || (mode === 'past' && isPast)) {
        if (!tipsByMatchId[tip.matchId]) tipsByMatchId[tip.matchId] = [];
        tipsByMatchId[tip.matchId].push(tip);
      }
    });

    const sortedMatchIds = Object.keys(tipsByMatchId).map(Number).sort((a, b) => {
      return new Date(schedule[a].datetime) - new Date(schedule[b].datetime);
    });

    sortedMatchIds.forEach(matchId => {
      const match = schedule[matchId];
      const matchLabel = `${match.teams[0]} vs ${match.teams[1]} (${match.date} ${match.time})`;
      const tips = tipsByMatchId[matchId];

      const section = document.createElement('div');
      section.className = 'match-section';
      const title = document.createElement('h3');
      title.textContent = matchLabel;
      section.appendChild(title);

      const table = document.createElement('table');
      table.className = 'tips-table';
      table.innerHTML = `
        <thead>
          <tr>
            <th rowspan="2">Jm√©no</th>
            <th rowspan="2">V√Ωsledek</th>
            <th colspan="3">St≈ôelci (dom√°c√≠)</th>
            <th colspan="3">St≈ôelci (host√©)</th>
          </tr>
          <tr>
            <th>1</th><th>2</th><th>3</th>
            <th>1</th><th>2</th><th>3</th>
          </tr>
        </thead>
      `;

      const tbody = document.createElement('tbody');

      tips.sort((a, b) => a.name.localeCompare(b.name)).forEach(tip => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${tip.name}</td>
          <td>${tip.score}</td>
          <td>${tip.homeScorers[0] || ''}</td>
          <td>${tip.homeScorers[1] || ''}</td>
          <td>${tip.homeScorers[2] || ''}</td>
          <td>${tip.awayScorers[0] || ''}</td>
          <td>${tip.awayScorers[1] || ''}</td>
          <td>${tip.awayScorers[2] || ''}</td>
        `;
        tbody.appendChild(row);
      });

      table.appendChild(tbody);
      section.appendChild(table);
      container.appendChild(section);
    });
  } catch (error) {
    console.error('Chyba naƒçten√≠ tip≈Ø:', error);
  }
};


  function showView(view) {
    const tips = document.getElementById('tipsContainer');
    const points = document.getElementById('pointsTable');
    const ranking = document.getElementById('rankingTable');

    tips.style.display = 'none';
    points.style.display = 'none';
    ranking.style.display = 'none';

    if (view === 'points') {
      points.style.display = 'block';
    } else if (view === 'ranking') {
      ranking.style.display = 'block';
    } else {
      tips.style.display = 'block';
      renderTips(view);
    }
  }

  window.onload = () => {
    populateMatches();
    renderTips('upcoming');
  };
</script>
